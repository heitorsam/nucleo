--------
--CHAT--
--------

DROP TABLE portal_projetos.CHAT;
CREATE TABLE portal_projetos.CHAT(

CD_CHAT             INT NOT NULL,
CD_OS               INT NOT NULL,
TP_CHAT             VARCHAR(1) NOT NULL,
MSG                 CLOB NOT NULL,
CD_USUARIO_CADASTRO VARCHAR(20) NOT NULL,
HR_CADASTRO         TIMESTAMP NOT NULL,
CD_USUARIO_ULT_ALT  VARCHAR(20),
HR_ULT_ALT          TIMESTAMP,

--PRIMARY_KEY
CONSTRAINT PK_CD_CHAT PRIMARY KEY (CD_CHAT)

);

---------------
--SEQ_CD_CHAT--
---------------

DROP SEQUENCE portal_projetos.SEQ_CD_CHAT; 
CREATE SEQUENCE portal_projetos.SEQ_CD_CHAT
START WITH 1    
INCREMENT BY 1
NOCACHE
NOCYCLE;

-------------------------------------------------------
-------------------------------------------------------
-------------------------------------------------------

ALTER TABLE portal_projetos.SOLICITACAO DROP CONSTRAINT FK_CD_RESPONSAVEL;
ALTER TABLE portal_projetos.PERGUNTA    DROP CONSTRAINT FK_CD_SOLICITACAO;
ALTER TABLE portal_projetos.ALTERNATIVA DROP CONSTRAINT FK_CD_PERGUNTA;
ALTER TABLE portal_projetos.RESPOSTA    DROP CONSTRAINT FRK_CD_PERGUNTA;
ALTER TABLE portal_projetos.PORTFOLIO   DROP CONSTRAINT FK_CD_GALERIA;
ALTER TABLE portal_projetos.PORTFOLIO   DROP CONSTRAINT FRK_CD_SOLICITACAO;

---------------
--RESPONSAVEL--
---------------


DROP TABLE portal_projetos.RESPONSAVEL;

CREATE TABLE portal_projetos.RESPONSAVEL(
CD_RESPONSAVEL         INT NOT NULL,
CD_USUARIO_MV          INT NOT NULL, ---FK TABELA USUARIOS MV
EMAIL                  VARCHAR(100),
TP_FUNCAO              VARCHAR(2), --(AD) - ADM / (AN) ANALISTA -- 
CD_USUARIO_CADASTRO    VARCHAR(20),
HR_CADASTRO            TIMESTAMP,
CD_USUARIO_ULT_ALT     VARCHAR(20), ---FK TABELA USUARIOS MV
HR_ULT_ALT             TIMESTAMP,

--PRIMARY_KEY
CONSTRAINT PK_CD_RESPONSAVEL PRIMARY KEY (CD_RESPONSAVEL),

--CHECK
CONSTRAINT CK_TP_FUNCAO
CHECK (TP_FUNCAO IN ('AD','AN'))

);

------------------
--SEQ_CD_USUARIO--
------------------

DROP SEQUENCE portal_projetos.SEQ_CD_RESPONSAVEL;

CREATE SEQUENCE portal_projetos.SEQ_CD_RESPONSAVEL
START WITH 1    
INCREMENT BY 1
NOCACHE
NOCYCLE;

---------------
--SOLICITACAO--
---------------

DROP TABLE portal_projetos.SOLICITACAO;

CREATE TABLE portal_projetos.SOLICITACAO(
CD_SOLICITACAO         INT NOT NULL, 
CD_OS_MV               INT NOT NULL, ---FK TABELA SOLICITACAO_OS MV
CD_RESPONSAVEL         INT NULL, --FK TABELA PORTAL_PROJETOS
TP_PRIORIDADE          VARCHAR(1), -- (M) Muito Alta / (A) Alta/ (E) M�dia /(B) Baixa / (X) Muito Baixa
TP_TIPO                VARCHAR(2), --(PR) - PROJETO / (PA) - PAINEL / (RP) REPORT / (DC) - DOCUMENTO PRONTURIARIO / (OT) - OUTROS
ESTIMATIVA_ENTREGA     DATE,
RAMAL_SOLICITANTE      VARCHAR2(20),
EMAIL_SOLICITANTE      VARCHAR2(50),
CD_USUARIO_CADASTRO    VARCHAR(20),  ---FK TABELA USUARIOS MV
HR_CADASTRO            TIMESTAMP,
CD_USUARIO_ULT_ALT     VARCHAR(20),  ---FK TABELA USUARIOS MV
HR_ULT_ALT             TIMESTAMP,

--PRIMARY_KEY
CONSTRAINT PK_CD_SOLICITACAO PRIMARY KEY (CD_SOLICITACAO),

--FOREIGN_KEY
CONSTRAINT FK_CD_RESPONSAVEL FOREIGN KEY (CD_RESPONSAVEL) REFERENCES portal_projetos.RESPONSAVEL(CD_RESPONSAVEL),

--CHECK
CONSTRAINT CK_TP_TIPO
CHECK (TP_TIPO IN ('PR','PA','RP','DC','OT')),

--CHECK
CONSTRAINT CK_TP_PRIORIDADE
CHECK (TP_PRIORIDADE IN ('M','A','E','B','X'))

);

----------------------
--SEQ_CD_SOLICITACAO--
----------------------


DROP SEQUENCE portal_projetos.SEQ_CD_SOLICITACAO;

CREATE SEQUENCE portal_projetos.SEQ_CD_SOLICITACAO
START WITH 1    
INCREMENT BY 1
NOCACHE
NOCYCLE;

------------
--PERGUNTA--
------------

DROP TABLE portal_projetos.PERGUNTA;

CREATE TABLE portal_projetos.PERGUNTA(
CD_PERGUNTA            INT NOT NULL,
TP_PERGUNTA            VARCHAR(2), --- (DE) DESCRITIVA / (AT) ALTERNATIVA / 
DS_PERGUNTA            VARCHAR(200),
CD_USUARIO_CADASTRO    VARCHAR(20),  ---FK TABELA USUARIOS MV
HR_CADASTRO            TIMESTAMP,
CD_USUARIO_ULT_ALT     VARCHAR(20),  ---FK TABELA USUARIOS MV
HR_ULT_ALT             TIMESTAMP,

--PRIMARY_KEY
CONSTRAINT PK_CD_PERGUNTA PRIMARY KEY (CD_PERGUNTA),

--FOREIGN_KEY
--CONSTRAINT FK_CD_SOLICITACAO FOREIGN KEY (CD_SOLICITACAO) REFERENCES portal_projetos.SOLICITACAO(CD_SOLICITACAO),

--CHECK
CONSTRAINT CK_TP_PERGUNTA
CHECK (TP_PERGUNTA IN ('DE','AT','NT'))

); 


----------------------
--SEQ_CD_PERGUNTA-----
----------------------


DROP SEQUENCE portal_projetos.SEQ_CD_PERGUNTA;

CREATE SEQUENCE portal_projetos.SEQ_CD_PERGUNTA
START WITH 1    
INCREMENT BY 1
NOCACHE
NOCYCLE;

---------------
--ALTERNATIVA--
---------------

DROP TABLE portal_projetos.ALTERNATIVA;

CREATE TABLE portal_projetos.ALTERNATIVA(
CD_ALTERNATIVA             INT NOT NULL,
CD_PERGUNTA                INT NOT NULL,
ORDEM                      INT NOT NULL,
DS_PERGUNTA                VARCHAR(200),
CD_USUARIO_CADASTRO        VARCHAR(20),  ---FK TABELA USUARIOS MV
HR_CADASTRO                TIMESTAMP,
CD_USUARIO_ULT_ALT         VARCHAR(20),  ---FK TABELA USUARIOS MV
HR_ULT_ALT                 TIMESTAMP,


--PRIMARY_KEY
CONSTRAINT PK_CD_ALTERNATIVA PRIMARY KEY (CD_ALTERNATIVA),

--FOREIGN_KEY
CONSTRAINT FK_CD_PERGUNTA  FOREIGN KEY (CD_PERGUNTA) REFERENCES portal_projetos.PERGUNTA(CD_PERGUNTA)

);

----------------------
--SEQ_CD_ALTERNATIVA-
----------------------

DROP SEQUENCE portal_projetos.SEQ_CD_ALTERNATIVA; 

CREATE SEQUENCE portal_projetos.SEQ_CD_ALTERNATIVA
START WITH 1    
INCREMENT BY 1
NOCACHE
NOCYCLE;

---------------
---RESPOSTA----
---------------

DROP TABLE portal_projetos.RESPOSTA;

CREATE TABLE portal_projetos.RESPOSTA(
CD_RESPOSTA                INT NOT NULL,
CD_PERGUNTA                INT NOT NULL,
CD_SOLICITACAO             INT NOT NULL,
DS_RESPOSTA                VARCHAR(200),
CD_USUARIO_CADASTRO        VARCHAR(20),  ---FK TABELA USUARIOS MV
HR_CADASTRO                TIMESTAMP,
CD_USUARIO_ULT_ALT         VARCHAR(20),  ---FK TABELA USUARIOS MV
HR_ULT_ALT                 TIMESTAMP,

--PRIMARY_KEY
CONSTRAINT PK_CD_RESPOSTA PRIMARY KEY (CD_RESPOSTA),

--FOREIGN_KEY
CONSTRAINT FRK_CD_PERGUNTA FOREIGN KEY (CD_PERGUNTA) REFERENCES portal_projetos.PERGUNTA(CD_PERGUNTA)

);

----------------------
--SEQ_CD_RESPOSTA-----
----------------------

DROP SEQUENCE portal_projetos.SEQ_CD_RESPOSTA;

CREATE SEQUENCE portal_projetos.SEQ_CD_RESPOSTA
START WITH 1    
INCREMENT BY 1
NOCACHE
NOCYCLE;

---------------
---GALERIA-----
---------------

DROP TABLE portal_projetos.GALERIA;

CREATE TABLE portal_projetos.GALERIA(
CD_GALERIA                 INT NOT NULL,
CD_PORTFOLIO               INT NOT NULL,
TP_GALERIA                 VARCHAR(2),
SN_PRINCIPAL               VARCHAR(1),
DOCUMENTO                  BLOB,
LINK_DOC               	   VARCHAR(100),
EXTENSAO                   VARCHAR(5),
CD_USUARIO_CADASTRO        VARCHAR(20),  ---FK TABELA USUARIOS MV
HR_CADASTRO                TIMESTAMP,
CD_USUARIO_ULT_ALT         VARCHAR(20),  ---FK TABELA USUARIOS MV
HR_ULT_ALT                 TIMESTAMP,

--PRIMARY_KEY
CONSTRAINT PK_CD_GALERIA PRIMARY KEY (CD_GALERIA),

--CHECK
CONSTRAINT CK_TP_GALERIA
CHECK (TP_GALERIA IN ('FT','VD','DC'))

);

----------------------
--SEQ_CD_GALERIA-----
----------------------

DROP SEQUENCE portal_projetos.SEQ_CD_GALERIA;

CREATE SEQUENCE portal_projetos.SEQ_CD_GALERIA
START WITH 1    
INCREMENT BY 1
NOCACHE
NOCYCLE;

-----------------
---PORTFOLIO-----
-----------------

DROP TABLE portal_projetos.PORTFOLIO;

CREATE TABLE portal_projetos.PORTFOLIO(
CD_PORTFOLIO               INT NOT NULL,
CD_SOLICITACAO             INT NOT NULL,
NM_PROJETO                 VARCHAR(100),
DS_PROJETO                 VARCHAR(100),
LINK_PROJETO               VARCHAR(100),
CD_USUARIO_CADASTRO        VARCHAR(20),  ---FK TABELA USUARIOS MV
HR_CADASTRO                TIMESTAMP,
CD_USUARIO_ULT_ALT         VARCHAR(20),  ---FK TABELA USUARIOS MV
HR_ULT_ALT                 TIMESTAMP,

--PRIMARY_KEY
CONSTRAINT PK_CD_PORTFOLIO PRIMARY KEY (CD_PORTFOLIO),

--FOREIGN_KEY
CONSTRAINT FRK_CD_SOLICITACAO FOREIGN KEY (CD_SOLICITACAO) REFERENCES portal_projetos.SOLICITACAO(CD_SOLICITACAO)

);

DROP SEQUENCE portal_projetos.SEQ_CD_PORTFOLIO;

CREATE SEQUENCE portal_projetos.SEQ_CD_PORTFOLIO
START WITH 1    
INCREMENT BY 1
NOCACHE
NOCYCLE;

-------------------
---JUSTIFICATIVA---
-------------------

DROP TABLE portal_projetos.JUSTIFICATIVA;

CREATE TABLE portal_projetos.JUSTIFICATIVA(
CD_JUSTI                INT NOT NULL,
CD_SOL               INT NOT NULL,
DS_JUST                VARCHAR(200),
CD_USUARIO_CADASTRO        VARCHAR(20),
HR_CADASTRO                TIMESTAMP,

--PRIMARY_KEY
CONSTRAINT PK_CD_JUSTI PRIMARY KEY (CD_JUSTI),

--FOREIGN_KEY
CONSTRAINT FRK_CD_SOL FOREIGN KEY (CD_SOL) REFERENCES portal_projetos.SOLICITACAO(CD_SOLICITACAO)

);

----------------------
--SEQ_CD_JUST-----
----------------------

DROP SEQUENCE portal_projetos.SEQ_CD_JUST;

CREATE SEQUENCE portal_projetos.SEQ_CD_JUST
START WITH 1    
INCREMENT BY 1
NOCACHE
NOCYCLE;

---------------
---ANEXOS-----
---------------

DROP TABLE portal_projetos.ANEXOS;

CREATE TABLE portal_projetos.ANEXOS(
CD_ANEXOS                  INT NOT NULL,
CD_SOLICITACAO             INT NOT NULL,
DOCUMENTO                  BLOB,
EXTENSAO                   VARCHAR(5),
CD_USUARIO_CADASTRO        VARCHAR(20),
HR_CADASTRO                TIMESTAMP,
CD_USUARIO_ULT_ALT         VARCHAR(20),
HR_ULT_ALT                 TIMESTAMP


);

----------------------
--SEQ_CD_ANEXOS-----
----------------------

DROP SEQUENCE portal_projetos.SEQ_CD_ANEXOS;

CREATE SEQUENCE portal_projetos.SEQ_CD_ANEXOS
START WITH 1    
INCREMENT BY 1
NOCACHE
NOCYCLE;

-------------------
---ANEXO FOTOS-----
-------------------

DROP TABLE portal_projetos.ANEXO_FOTOS;

CREATE TABLE portal_projetos.ANEXO_FOTOS(
CD_ANEXO_FOTO              INT NOT NULL,
BLOB_FOTO                  BLOB,
CD_USUARIO_CADASTRO        VARCHAR(20),
HR_CADASTRO                TIMESTAMP,
CD_USUARIO_ULT_ALT         VARCHAR(20),
HR_ULT_ALT                 TIMESTAMP

);

----------------------
--SEQ_CD_ANEXO_FOTO-----
----------------------

DROP SEQUENCE portal_projetos.SEQ_CD_ANEXO_FOTO;

CREATE SEQUENCE portal_projetos.SEQ_CD_ANEXO_FOTO
START WITH 1    
INCREMENT BY 1
NOCACHE
NOCYCLE;

------------------------
---TABELA DE ACESSO-----
------------------------

DROP TABLE portal_projetos.ACESSO;

CREATE TABLE portal_projetos.ACESSO(
CD_ACESSO         INT NOT NULL,
CD_PORTFOLIO      INT NOT NULL,
DS_PROJETO        VARCHAR2(50),
CD_USUARIO_ACESSO VARCHAR2(20),
HR_ACESSO         TIMESTAMP,

--PRIMARY_KEY
CONSTRAINT PK_CD_ACESSO PRIMARY KEY (CD_ACESSO),

--FOREIGN_KEY
CONSTRAINT FRK_CD_PORTFOLIO FOREIGN KEY (CD_PORTFOLIO) REFERENCES portal_projetos.PORTFOLIO(CD_PORTFOLIO)


);

DROP SEQUENCE portal_projetos.SEQ_CD_ACESSO;

CREATE SEQUENCE portal_projetos.SEQ_CD_ACESSO
START WITH 1    
INCREMENT BY 1
NOCACHE
NOCYCLE;

----------
--COMMIT--
----------
COMMIT;
